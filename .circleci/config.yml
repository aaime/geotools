version: 2 
jobs: # a collection of steps
  geotools: 
    working_directory: ~/geotools
    docker: 
      - image: circleci/openjdk:8u212-jdk-stretch
        command: ["/bin/bash"]
    steps: 
      - checkout # check out source code to working directory
      - run: mvn install -Da  -DskipTests # run the build and prepare fresh geotools artifacts
     
  geowebcache:
    working_directory: ~/geowebcache 
    docker: 
      - image: circleci/openjdk:8u212-jdk-stretch
        command: ["/bin/bash"]
    steps:  
      - run:
          name: Avoid hosts unknown for github
          command: mkdir ~/.ssh/ && echo -e "Host github.com\n\tStrictHostKeyChecking no\n" > ~/.ssh/config
      - run:
          name: "Get and build GeoWebCache"
          command: |
            git clone git@github.com:GeoWebCache/geowebcache.git ~/geowebcache
            cd ~/geowebcache
            mvn install
workflows:
  version: 2
  build_geotools_dependencies:
    jobs:
      - geotools
      - geowebcache:
          requires: 
            - geotools